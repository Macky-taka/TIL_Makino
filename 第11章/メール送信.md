# アカウント有効化のメール送信
アカウント有効化メールの送信に必要なコードを追加する。
このメソッドではAction Mailerライブラリを使ってUserのメイラーを追加する。
このメイラーはUsersコントローラの```create```アクションで有効化リンクをメール送信するために使う。

###送信メールのテンプレート
最初に、生成されたテンプレートをカスタマイズして、実際に有効化メールで使えるようにする。
次に、ユーザーを含むインスタンス変数を作成してビューで使えるようにし、user.emailにメール送信する。

クエリパラメータを使って、このURLにメールアドレスもうまく組み込む。
メールアドレスの「@」記号がURLでは「%40」となっている点に注目すると、「エスケープ」と呼ばれる手法で、通常URLでは扱えない文字を扱えるようにするために変換されている。

### 送信メールのプレビュー
Railsでは、特殊なURLにアクセスするとメールのメッセージをその場でプレビューすることができる。
そのためにdevelop環境の設定に手を加える。
```account_activation```の引数には有効なUserオブジェクトを渡す必要があるため、user変数が開発用データベースの最初のユーザーになるように定義して、それを```UserMailer.account_activation```の引数として渡す。
previewの場所は/rails/mailers/user_mailer/account_activation
テキストファイルはコメントアウトも表示される（そりゃそう）
### 送信メールのテスト
プレビューをダブルチェックする。
```asert_match```という強力なメソッド
```
assert_match 'foo', 'foobar'      # true
assert_match 'baz', 'foobar'      # false
assert_match /\w+/, 'foobar'      # true
assert_match /\w+/, '$#!*+@'      # false
```
```CGI.escape(user.email)```でテスト用ユーザーのメアドをエスケープすることも可能。

### ユーザーの```create```アクション更新
ユーザー登録を行うcreateアクションに数行追加するだけで、メイラーをアプリケーションで実際に使うことができる。
