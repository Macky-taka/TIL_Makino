# ユーザーを更新する

### 編集フォーム

ユーザー編集ページの正しいURLが/users/1/editとなっている。
Railsは、```form_with(@user)```を使ってフォームを構成すると、```@user.new_record?```が```true```のときにはPOSTを、```false```のときにはPATCHを使う。
```target="_blank"```を使うとリンク先を新しいタブ（またはウィンドウ）で開くようになる.

しかし、```target="_blank"```で新しいページを開くときには、セキュリティ上の小さな問題があります。
それは、リンク先のサイトがHTMLドキュメントの```window```オブジェクトを扱えてしまう、という点がある。
それを防ぐために、aタグの```rel(relationship)```属性に```rel="noopener"```と設定すれば良い。

### 編集の失敗
ユーザー登録と似ている。```update```を使って送信された```params```ハッシュに基いてユーザーを更新する。
無効な情報が送信された場合、更新の結果として```fals```が返され、```else```に分岐して編集ページをレンダリングする。

 ### 編集失敗時のテスト
 失敗した時のテストをかく。
 まず初めにedit viewが描画されるかどうかを確認する。
 
 ### TDDでの成功
 プロフィール画像の編集は、画像のアップロードをGravatarに任せてあるので、既に動作する。
 ［change］リンクをクリックするとGravaterのサイト（図 10.2）が新しいタブで開き（```target="_blank```"のおかげ）、Gravatarを編集できる。<br>
 受け入れテスト（Acceptance Tests）: ある機能の実装が完了し、受け入れ可能な状態になったかどうかを決めるテスト
 ユーザーを更新する正しい振る舞いのテストを行う。次に、flashメッセージが空でないかどうかと、プロフィールページにリダイレクトされるかどうかをチェックする。
 また、データベース内のユーザー情報が正しく変更されたかどうかも検証する。この時、パスワードとパスワード確認が空である。それは、
 ユーザー名やメールアドレスを編集するときに毎回パスワードを入力するのは不便なので、（パスワードを変更する必要が無いときは）パスワードを入力せずに更新できると便利だからである.
 パスワードのバリデーションに例外処理を加える必要がある。
 
 @user.reloadを使って、データベースから最新のユーザー情報を読み込み直して、正しく更新されたかどうかを確認も行う。
 
